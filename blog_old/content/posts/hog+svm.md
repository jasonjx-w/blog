+++
title = "HOG+SVM 进行字符识别"
date = 2018-05-08
tags = [
    "hog",
    "svm",
    "ocr"
]

+++

近期接到一个小项目。
背景是要在生产线上对产品的显示屏进行检验。显示屏会显示一些数字或图标，这个项目就是需要设计一个系统识别这些数字或图标。
考虑到在工业视觉中，对字符的识别（OCR）需求也较为广泛。所以我想要选择一种通用性较强，但执行效率较高的算法。  

对字符的识别并不困难，比如车牌识别。车牌识别系统在采集图像的时候，往往会将车牌照的很亮，并且为了方便识别，车牌也是经过特殊设计，这导致车牌识别的结果较为理想，甚至只需采用模版匹配就可以实现。  
但在工厂环境下，现场环境复杂。我接到到项目是检测家用白电上的显示屏，产品外壳经过抛光，十分光亮，加重了光照的干扰，导致最终采集到的图像效果并不理想。图标还好，字符往往是扭曲、间断或粘连的。本来应该有的特征全部消失。  
所以不得已选择了之前上学时，用来进行行人探测的hog特征来进行字符识别。  

hog特征对字符的扭曲、间断有一定的鲁棒性。
另外，考虑到字符之间的粘连，我选择了较为通用的粘连字符分隔方法，滴水算法。  

<!--more-->

# HOG特征
HOG特征,即方向梯度直方图特征(Histogram of Orient Gradient)[[Dalal2005]](http://lear.inrialpes.fr/people/triggs/pubs/Dalal-cvpr05.pdf).将图案边缘的梯度方向作为特征.
除hog特征之外,lbp特征,haar特征都是常用的特征.
### 基本思路
hog原理如下图所示,在图像中计算梯度,进而求得梯度的模和角度.根据梯度的模和角度,将其转化为一个统计特征直方图(bin).
<div align = "center">
<img src = "./hog_1.png">
</div>
这样,图案的边缘信息即可转换为一个特征向量.利用这些特征向量,即可对图案进行识别.

### 术语解释
<div align = "center">
<img src = "fig2.png">
</div>
1. `cell`:虽然图像的最小单位是`像素(pixel)`,但是hog特征所用到的最小单位是`cell`.比如上图,一个`cell`由2*2=4个像素构成.
2. `block`:在计算hog特征时,`block`会在`window`中滑动,滑动的步距叫作`位移增量(blockstride)`.
每滑动一次,都会计算对应的`block`的hog特征,最后这些特征会被连接起来,构成一个更长的特征向量.
3. `window`:在计算hog特征时,通常并不会计算一整幅图的hog特征,而只会计算一个`window`内的hog特征.当两个`window`内的hog特征类似的时候,可以认为`window`内的图案时一样的.

### 原理和实现
1. 梯度的计算方法.
    1. 数学原理:
    $$G(p)=\sqrt{H_x^2(p)+H_y^2(p)}$$
    $$\theta(p)=tan^-1\frac{H_x(p}{H_y(p)}$$
    2. 特征向量
    将梯度角度划分区间:`range = [i,i+\delta]`,连接形成直方图,纵轴用梯度的2范数$|G(p)|_2$做累加.
2. opencv函数调用.
3. 可能需要的预处理
    1. 对比度归一化
    Gamma校正法:$I(p) = I(p)^\gamma$ 



# svm(support vector mechin 支持向量机)
## 原理  
## 算法

# 粘连字符的分割
## 滴水算法(dropfall)

# 环境的干扰

## 光照
光照干扰是所有视觉系统都无法避免的,目前也没有特效的消除算法.
相机和人眼的结构不同,人眼的视觉神经可以调节不同位置对光的敏感程度.这使得人眼对光比的包容程度较大,可以在一个场景下看清亮部和暗部.并且人脑会根据对环境的理解自动的消除光照的影响.由于相机系统的物理结构限制,导致其对光比的包容程度较低.常常会出现局部`过曝`或`欠曝`的情况.
目前比较常用的做法是:采集多张不同参数下的图片,对其进行融合.以求尽可能提高照片的最终效果.
如民用相机中多配备的`高动态光照渲染(HDR)`技术,即通过不同的曝光时间,采集多张图片--曝光时间短时,图像偏暗,取其亮部;而曝光时间长时,图像偏亮,取其暗部,最终融合成一张无论亮部还是暗部都有良好效果的图片.
工业相机中也有类似思路的处理方法,如使用`可编程光源`和`相机的多角度放置`.
不断改变人工光源的方向,采集多张图片,最终融合成一张图片;
同一场景,不同视角的相机采集到的图片受光照影响不同.通过融合不同相机采集到的图像也可以一定程度上消除光照影响.
但这些方法在实际的场景中都远远达不到可以称之为'理想'的效果.
所以,一般场景允许,大家都会在物理结构上下功夫,如加个遮光罩或者加个偏振镜等.